<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irys Final Quest - IRYS TOWN</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Game Audio Elements -->
    <audio id="bgMusic" loop>
        <!-- Grand/celebration music -->
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="questCompleteSound" preload="auto">
        <source src="https://www.soundjay.com/button/sounds/button-09a.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="optionSelectSound" preload="auto">
        <source src="https://www.soundjay.com/button/sounds/button-21.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="correctSound" preload="auto">
        <source src="https://www.soundjay.com/button/sounds/button-09a.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="wrongSound" preload="auto">
        <source src="https://www.soundjay.com/button/sounds/button-10.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="buttonHoverSound" preload="auto">
        <source src="https://www.soundjay.com/button/sounds/button-21.mp3" type="audio/mpeg">
    </audio>
    <style>
        .quest-container {
            max-width: 800px;
            margin: 2rem auto;
            text-align: center;
        }
        .quest-step {
            background: rgba(0, 212, 255, 0.1);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
            display: none;
        }
        .quest-step.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 2rem 0;
        }
        .option {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        .option:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateX(5px);
        }
        .progress-container {
            width: 100%;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
            height: 10px;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        .quest-image {
            max-width: 100%;
            border-radius: 5px;
            margin: 1rem 0;
            border: 1px solid var(--primary-color);
        }
        .completion-badge {
            width: 100px;
            height: 100px;
            margin: 0 auto 2rem;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2300d4ff"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>') no-repeat center;
            background-size: contain;
            animation: bounce 1s ease infinite alternate;
        }
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: confetti 5s ease-in-out infinite;
        }
        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="game-title">IRYS FINAL QUEST</h1>
            <p class="tagline">Your journey to master Irys reaches its climax!</p>
        </header>
        
        <main class="quest-container">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <!-- Step 1 -->
            <div class="quest-step active" id="step1">
                <h2>The Irys Core</h2>
                <p>You stand before the Irys Core, the heart of the network. The core is unstable and needs your help to stabilize it. The first step is to understand the core principles of Irys.</p>
                <p>What is the fundamental principle that makes Irys unique?</p>
                
                <div class="options">
                    <div class="option" data-correct="false">Centralized control for efficiency</div>
                    <div class="option" data-correct="true">Decentralized, permanent storage</div>
                    <div class="option" data-correct="false">Temporary data hosting</div>
                    <div class="option" data-correct="false">High-frequency trading</div>
                </div>
            </div>
            
            <!-- Step 2 -->
            <div class="quest-step" id="step2">
                <h2>The Data Stream</h2>
                <p>You've successfully stabilized the core! Now, you need to optimize the data stream. Data is flowing in from multiple sources and needs to be processed efficiently.</p>
                <p>How does Irys handle large amounts of data efficiently?</p>
                
                <div class="options">
                    <div class="option" data-correct="false">By compressing all data to the maximum</div>
                    <div class="option" data-correct="false">By storing only the most recent data</div>
                    <div class="option" data-correct="true">Through a decentralized network of nodes</div>
                    <div class="option" data-correct="false">By limiting upload sizes</div>
                </div>
            </div>
            
            <!-- Step 3 -->
            <div class="quest-step" id="step3">
                <h2>The Final Challenge</h2>
                <p>You've come so far! The final challenge awaits. The Irys network is under attack, and you need to implement the best security measures to protect it.</p>
                <p>What is the best approach to secure the Irys network?</p>
                
                <div class="options">
                    <div class="option" data-correct="false">Rely on a single, powerful server</div>
                    <div class="option" data-correct="true">Use decentralized encryption and redundancy</div>
                    <div class="option" data-correct="false">Limit access to a select few</div>
                    <div class="option" data-correct="false">Store everything in multiple physical locations</div>
                </div>
            </div>
            
            <!-- Completion Screen -->
            <div class="quest-step" id="completion">
                <div class="completion-badge"></div>
                <h2>Quest Complete!</h2>
                <p>Congratulations, you've successfully completed the Irys Final Quest!</p>
                <p>You've demonstrated a deep understanding of Irys and its capabilities. The network is now stable and secure, thanks to your efforts.</p>
                <p>As a master of Irys, you're now ready to build the future of decentralized storage!</p>
                
                <div style="margin-top: 2rem;">
                    <button onclick="window.location.href='index.html'" class="back-button">Back to Main Menu</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Audio Manager
        const audioManager = {
            // Audio elements
            bgMusic: document.getElementById('bgMusic'),
            questComplete: document.getElementById('questCompleteSound'),
            optionSelect: document.getElementById('optionSelectSound'),
            correct: document.getElementById('correctSound'),
            wrong: document.getElementById('wrongSound'),
            buttonHover: document.getElementById('buttonHoverSound'),
            
            // Play sound function
            play(sound, volume = 0.5) {
                try {
                    const audio = this[sound];
                    if (audio) {
                        audio.volume = volume;
                        audio.currentTime = 0;
                        audio.play().catch(e => console.log('Audio play failed:', e));
                    }
                } catch (e) {
                    console.error('Error playing sound:', e);
                }
            },
            
            // Set background music
            setBgMusic(enabled) {
                if (enabled) {
                    this.bgMusic.volume = 0.3;
                    this.bgMusic.play().catch(e => console.log('Background music play failed:', e));
                } else {
                    this.bgMusic.pause();
                }
            }
        };

        // Initialize audio on user interaction
        function initAudio() {
            // Enable audio on first user interaction
            const enableAudio = () => {
                audioManager.setBgMusic(true);
                document.removeEventListener('click', enableAudio);
                document.removeEventListener('keydown', enableAudio);
            };
            
            document.addEventListener('click', enableAudio);
            document.addEventListener('keydown', enableAudio);
            
            // Add hover sound to all buttons and options
            document.querySelectorAll('button, .option').forEach(element => {
                element.addEventListener('mouseenter', () => {
                    audioManager.play('buttonHover', 0.3);
                });
            });
        }

        // Initialize audio when DOM is loaded
        document.addEventListener('DOMContentLoaded', initAudio);

        let currentStep = 1;
        const totalSteps = 3;
        let correctAnswers = 0;
        
        // DOM Elements
        const progressBar = document.getElementById('progress-bar');
        
        // Initialize the quest
        document.addEventListener('DOMContentLoaded', () => {
            updateProgressBar();
            setupOptionHandlers();
        });
        
        function updateProgressBar() {
            const progress = ((currentStep - 1) / totalSteps) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        function setupOptionHandlers() {
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    const isCorrect = this.getAttribute('data-correct') === 'true';
                    
                    if (isCorrect) {
                        this.style.background = 'rgba(0, 255, 0, 0.2)';
                        this.style.borderColor = '#00ff00';
                        correctAnswers++;
                        
                        // Play correct sound
                        audioManager.play('correct');
                        
                        // Move to next step after a delay
                        setTimeout(() => {
                            if (currentStep < totalSteps) {
                                document.getElementById(`step${currentStep}`).classList.remove('active');
                                currentStep++;
                                document.getElementById(`step${currentStep}`).classList.add('active');
                                updateProgressBar();
                            } else {
                                // Show completion screen
                                document.getElementById(`step${currentStep}`).classList.remove('active');
                                document.getElementById('completion').classList.add('active');
                                progressBar.style.width = '100%';
                                
                                // Create confetti effect
                                createConfetti();
                                
                                // Save completion
                                const gameState = JSON.parse(localStorage.getItem('irysTownProgress') || '{}');
                                gameState.completedLevels = gameState.completedLevels || [];
                                if (!gameState.completedLevels.includes(5)) {
                                    gameState.completedLevels.push(5);
                                    gameState.gameCompleted = true;
                                    localStorage.setItem('irysTownProgress', JSON.stringify(gameState));
                                }
                            }
                        }, 1000);
                    } else {
                        this.style.background = 'rgba(255, 0, 0, 0.2)';
                        this.style.borderColor = '#ff0000';
                        
                        // Play wrong sound
                        audioManager.play('wrong');
                        
                        // Highlight correct answer
                        const correctOption = this.parentElement.querySelector('[data-correct="true"]');
                        if (correctOption) {
                            correctOption.style.background = 'rgba(0, 255, 0, 0.2)';
                            correctOption.style.borderColor = '#00ff00';
                        }
                        
                        // Disable all options
                        const allOptions = this.parentElement.querySelectorAll('.option');
                        allOptions.forEach(opt => {
                            opt.style.pointerEvents = 'none';
                        });
                        
                        // Allow retry after a delay
                        setTimeout(() => {
                            allOptions.forEach(opt => {
                                opt.style.background = 'rgba(0, 212, 255, 0.1)';
                                opt.style.borderColor = 'var(--primary-color)';
                                opt.style.pointerEvents = 'auto';
                            });
                        }, 2000);
                    }
                });
            });
        }
        
        function createConfetti() {
            // Play quest complete sound
            audioManager.play('questComplete');
            
            const colors = ['#00d4ff', '#ff00ff', '#ffff00', '#00ff00', '#ff0000', '#0000ff'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 5}s`;
                confetti.style.animationDuration = `${3 + Math.random() * 4}s`;
                document.body.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 8000);
            }
            
            // Add click sound to the back button
            const backBtn = document.querySelector('.back-button');
            if (backBtn) {
                backBtn.addEventListener('click', () => {
                    audioManager.play('buttonHover');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 300);
                });
                backBtn.addEventListener('mouseenter', () => audioManager.play('buttonHover', 0.3));
            }
        }
    </script>
</body>
</html>
